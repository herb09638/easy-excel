<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>导入 - Easy Excel</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="使用简单易用的语义化接口快速读写Excel文件">
    <meta name="keywords" content="Easy Excel, xlsx, csv, ods, box spout">
    <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="canonical" href="../../docs-master-import.html" />
    
     <link rel="stylesheet" href="../../assets/css/laravel.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css">
     <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,800,800i,900,900i">
     <link rel="stylesheet" href="../../assets/font-awesome/css/font-awesome.min.css">

             <link rel="stylesheet" href="../../assets/gitalk/gitalk.css">
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src="https://hm.baidu.com/hm.js?86772cdd7983cf277a39d59e4238b721";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

</head>
<body class="docs language-default">
    
        
        
        
    
    <span class="overlay"></span>

    <nav class="main">
        <a href="../../index.html" class="brand nav-block">
            <span>Easy Excel</span>
        </a>

        <ul class="main-nav">
            <li class=""><a href="../../docs.html">

        文档</a></li>
<li class=""><a href="https://github.com/jqhph/easy-excel" target="_blank">

        Github</a></li>
<li class=""><a href="../../docs.html">
        打赏</a></li>



    
    

        
        

        

        
        
        
        
        
        

    

        </ul>

        <div class="search nav-block invisible">
            <img src="../../assets/svg/search.svg" />
            <input placeholder="search" type="text" id="search-input" aria-label="search"/>
        </div>

                    <div class="switcher">
	<div class="dropdown">
		<button class="btn dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
			Master
			<span class="caret"></span>
		</button>
		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
							<li role="presentation">
					<a role="menuitem" tabindex="-1" href="../../docs-master-import.html">Master</a>
				</li>
					</ul>
	</div>
</div>
        
        <div class="responsive-sidebar-nav">
            <a href="#" class="toggle-slide menu-link btn">&#9776;</a>
        </div>
    </nav>

    <nav id="slide-menu" class="slide-menu" role="navigation">

	<div class="brand">
		<a href="../../index.html">
			Easy Excel
		</a>
	</div>

	<ul class="slide-main-nav">
		<li><a href="../../index.html">Home</a></li>

		<li class=""><a href="../../docs.html">

        文档</a></li>
<li class=""><a href="https://github.com/jqhph/easy-excel" target="_blank">

        Github</a></li>
<li class=""><a href="../../docs.html">
        打赏</a></li>



    
    

        
        

        

        
        
        
        
        
        

    

	</ul>

	<div class="slide-docs-nav">
		<h2>Documentation</h2>

		<ul class="slide-docs-version">
			<li>
				<h2>Version</h2>

				<ul>
					<li>
													<div class="switcher">
	<div class="dropdown">
		<button class="btn dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
			Master
			<span class="caret"></span>
		</button>
		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
							<li role="presentation">
					<a role="menuitem" tabindex="-1" href="../../docs-master-import.html">Master</a>
				</li>
					</ul>
	</div>
</div>
											</li>
				</ul>
			</li>
		</ul>

		<ul>
<li>
<h2><a href="../../docs/master/installation.html">安装</a></h2>
</li>
<li>
<h2><a href="../../docs/master/export.html">导出</a></h2>
</li>
<li>
<h2><a href="../../docs/master/import.html">导入</a></h2>
</li>
<li>
<h2><a href="../../docs/master/qa.html">常见问题</a></h2>
</li>
<li>
<h2><a href="../../docs/master/compare.html">框架对比</a></h2>
</li>
<li>
<h2><a href="../../docs/master/update.html">更新日志</a></h2>
</li>
</ul>
	</div>

</nav>

<div class="docs-wrapper container" style="min-height:65vh">

	<section class="sidebar">
		
		<small><a href="#" id="doc-expand" style="font-size: 11px; color: #B8B8B8;">EXPAND ALL</a></small>
		<ul>
<li>
<h2><a href="../../docs/master/installation.html">安装</a></h2>
</li>
<li>
<h2><a href="../../docs/master/export.html">导出</a></h2>
</li>
<li>
<h2><a href="../../docs/master/import.html">导入</a></h2>
</li>
<li>
<h2><a href="../../docs/master/qa.html">常见问题</a></h2>
</li>
<li>
<h2><a href="../../docs/master/compare.html">框架对比</a></h2>
</li>
<li>
<h2><a href="../../docs/master/update.html">更新日志</a></h2>
</li>
</ul>
	</section>

	<article>
		<h1>导入</h1>
<h2>设置文件路径</h2>
<p><code  >Easy Excel</code> 会根据传入的文件名后缀自动判断需要读取的文件类型。</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

// 导入xlsx
$allSheets = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;toArray();

// 导入csv
$allSheets = Excel::import(&#039;/tmp/users.csv&#039;)-&gt;toArray();

// 导入ods
$allSheets = Excel::import(&#039;/tmp/users.ods&#039;)-&gt;toArray();</code></pre>
<h3>UploadFile</h3>
<p><code  >Laravel</code> 和 <code  >Symfony</code> 框架中可以直接导入浏览器上传的文件</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use Illuminate\Http\Request;

class IndexController
{
    public function upload(Request $request)
    {
        // 直接读取前端上传的文件
        $allSheets = Excel::import($request-&gt;file(&#039;user_data&#039;))-&gt;toArray();
    }

}</code></pre>
<h3>Filesystem</h3>
<p><code  >Easy Excel</code> 对 <code  >league/flysystem</code> 提供了支持，通过 <code  >Filesystem</code> 可以轻松的读取任意服务器上的文件。</p>
<blockquote>
<p>{tip} 此方法会将文件从文件所在服务器下载到本项目服务器临时目录，然后再读取文件内容。如果文件所在服务器和当前项目服务器都是同一台，则会造成资源浪费。</p>
</blockquote>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use League\Flysystem\Adapter\Local;
use League\Flysystem\Filesystem;

$adapter = new Local(__DIR__);

$filesystem = new Filesystem($adapter);

$allSheets = Excel::import(&#039;users.xlsx&#039;)-&gt;disk($filesystem)-&gt;toArray();</code></pre>
<h3>在Laravel中使用Filesystem</h3>
<p><code  >Easy Excel</code> 对 <code  >Laravel</code> 的 <code  >Filesystem</code> 也提供了支持：</p>
<p>打开 <code  >config/filesystems.php</code> 中找到如下配置：</p>
<pre><code   class="language-php">return [
    ...

    &#039;disks&#039; =&gt; [

        &#039;local&#039; =&gt; [
            &#039;driver&#039; =&gt; &#039;local&#039;,
            &#039;root&#039; =&gt; storage_path(&#039;app&#039;),
        ],

        ...

    ],
];</code></pre>
<p>使用：</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

$array = [...];

// local 对应配置参数 config(&#039;filesystems.disks.local&#039;)
$allSheets = Excel::import(&#039;users.xlsx&#039;)-&gt;disk(&#039;local&#039;)-&gt;toArray();

// 也可以
$allSheets = Excel::import(&#039;users.xlsx&#039;)-&gt;disk(Storage::disk(&#039;local&#039;))-&gt;toArray();</code></pre>
<h2>标题</h2>
<p><code  >Easy Excel</code> 默认会把Excel表格中的<strong>第一行</strong>数据当做标题，然后合并到读取的数据行中（作为数据行的key使用）。如果开发者想使用自定义标题，则可以以下方式设置：</p>
<blockquote>
<p>{tip} 此处设置的标题无法改变列顺序。</p>
</blockquote>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

$headings = [&#039;id&#039;, &#039;email&#039;, &#039;name&#039;];

// 导入xlsx
$allSheets = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;headings($headings)-&gt;toArray();

var_dump($allSheets);</code></pre>
<p>将得到如下结果</p>
<pre><code   class="language-php">[
    &#039;Sheet1&#039; =&gt; [
        2 =&gt; [&#039;id&#039; =&gt; 1, &#039;email&#039; =&gt; &#039;treutel@eg.com&#039;, &#039;name&#039; =&gt; &#039;Brakus&#039;],
        3 =&gt; [&#039;id&#039; =&gt; 2, &#039;email&#039; =&gt; &#039;josefa@eg.com&#039;, &#039;name&#039; =&gt; &#039;Eichmann&#039;],
    ],
];</code></pre>
<h3>指定标题所在的行</h3>
<p>如果标题不在<strong>第一行</strong>，则可以通过以下方法轻松的指定标题所在的行</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

$headings = [&#039;id&#039;, &#039;email&#039;, &#039;name&#039;];

// 指定第二行为标题行
$allSheets = Excel::import(&#039;/tmp/users.xlsx&#039;)
    -&gt;headings($headings)
    -&gt;headingRow(2)
    -&gt;toArray();

// 也可以传闭包
$allSheets = Excel::import(&#039;/tmp/users.xlsx&#039;)
    -&gt;headings($headings)
    -&gt;headingRow(function (int $line, array $row) {
        // $line 为数据行在excel表中的行号，$row 为数据行内容
        return $line == 2;
    })
    -&gt;toArray();

var_dump($allSheets);</code></pre>
<p>将得到如下结果</p>
<pre><code   class="language-php">[
    &#039;Sheet1&#039; =&gt; [
        3 =&gt; [&#039;id&#039; =&gt; 1, &#039;email&#039; =&gt; &#039;treutel@eg.com&#039;, &#039;name&#039; =&gt; &#039;Brakus&#039;],
        4 =&gt; [&#039;id&#039; =&gt; 2, &#039;email&#039; =&gt; &#039;josefa@eg.com&#039;, &#039;name&#039; =&gt; &#039;Eichmann&#039;],
    ],
];</code></pre>
<h3>禁用标题</h3>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

// 导入xlsx
$allSheets = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;headings(false)-&gt;toArray();

var_dump($allSheets);</code></pre>
<p>将得到如下结果</p>
<pre><code   class="language-php">[
    &#039;Sheet1&#039; =&gt; [
        2 =&gt; [1, &#039;treutel@eg.com&#039;, &#039;Brakus&#039;],
        3 =&gt; [2, &#039;josefa@eg.com&#039;, &#039;Eichmann&#039;],
    ],
];</code></pre>
<h2>读取数据</h2>
<h3>toArray</h3>
<p>把所有表格数据转化为数组。</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

// 导入xlsx
$allSheets = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;toArray();

var_dump($allSheets);</code></pre>
<p>结果</p>
<pre><code   class="language-php">[
    // 如果是xlsx和ods文件，此处下标为工作表名称，即 Sheet1
    // 如果是csv文件，此处下标为工作表序号，从 0 开始
    &#039;Sheet1&#039; =&gt; [
        // 此处下标是行号，由于标题占用了 1 行，所以数据行一般是从 2 开始
        2 =&gt; [&#039;id&#039; =&gt; 1, &#039;email&#039; =&gt; &#039;treutel@eg.com&#039;, &#039;name&#039; =&gt; &#039;Brakus&#039;],
        3 =&gt; [&#039;id&#039; =&gt; 2, &#039;email&#039; =&gt; &#039;josefa@eg.com&#039;, &#039;name&#039; =&gt; &#039;Eichmann&#039;],
    ],
];</code></pre>
<h3>collect</h3>
<p>把所有表格数据转化为 <code  >SheetCollection</code> 对象。</p>
<blockquote>
<p>{tip} 没错！<code  >SheetCollection</code> 的功能与 <code  >Laravel</code> 中的 <code  >collection</code> 的功能是一模一样的，<code  >collection</code> 对数组的操作非常方便，所以此处集成进来了。</p>
</blockquote>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

// 导入xlsx
$allSheetsCollection = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;collect();</code></pre>
<h3>each</h3>
<p>循环sheet表格</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use Dcat\EasyExcel\Contracts\Sheet as SheetInterface;

Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;each(function (SheetInterface $sheet) {
    // 单独处理每个表格内容
    $sheetArray = $sheet-&gt;toArray();

    // 获取表格名称，如果是csv文件，则此方法返回空字符串
    $sheetName = $sheet-&gt;getName();

    // 表格序号，从 0 开始
    $sheetIndex = $sheet-&gt;getIndex();

    var_dump($sheetArray);
})</code></pre>
<p>打印结果</p>
<pre><code   class="language-php">[
    // 此处下标是行号，由于标题占用了 1 行，所以数据行一般是从 2 开始
    2 =&gt; [&#039;id&#039; =&gt; 1, &#039;email&#039; =&gt; &#039;treutel@eg.com&#039;, &#039;name&#039; =&gt; &#039;Brakus&#039;],
    3 =&gt; [&#039;id&#039; =&gt; 2, &#039;email&#039; =&gt; &#039;josefa@eg.com&#039;, &#039;name&#039; =&gt; &#039;Eichmann&#039;],
]</code></pre>
<h3>first</h3>
<p>读取第一个表格内容</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

// Dcat\EasyExcel\Contracts\Sheet
$sheet = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;first();

// 表格名称
$sheetName = $sheet-&gt;getName();

var_dump($sheet-&gt;toArray());</code></pre>
<p>打印结果</p>
<pre><code   class="language-php">[
    // 此处下标是行号，由于标题占用了 1 行，所以数据行一般是从 2 开始
    2 =&gt; [&#039;id&#039; =&gt; 1, &#039;email&#039; =&gt; &#039;treutel@eg.com&#039;, &#039;name&#039; =&gt; &#039;Brakus&#039;],
    3 =&gt; [&#039;id&#039; =&gt; 2, &#039;email&#039; =&gt; &#039;josefa@eg.com&#039;, &#039;name&#039; =&gt; &#039;Eichmann&#039;],
]</code></pre>
<h3>active</h3>
<p>读取保存文件前打开的表格内容</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

$activeSheetArray = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;active()-&gt;toArray();

var_dump($activeSheetArray);</code></pre>
<h3>sheet</h3>
<p>根据表格名称或位置索引读取指定表格内容，默认的表格名称通常为 <code  >Sheet1</code>。</p>
<blockquote>
<p>{tip} <code  >CSV</code> 文件不支持根据名称读取表格内容。</p>
</blockquote>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;

// 根据表格名称读取表格内容
$sheet1 = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;sheet(&#039;Sheet1&#039;);

// 根据表格的位置索引读取指定表格内容
$firstSheet = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;sheet(0);</code></pre>
<h2>Sheet操作接口</h2>
<p><code  >Easy Excel</code> 提供了一些非常简单实用的接口用于读取表格数据。</p>
<h3>分块读取</h3>
<p>当数据表内容比较多时，使用分块读取功能可以有效减少内存消耗，提高效率。</p>
<p>操作所有表格</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use Dcat\EasyExcel\Contracts\Sheet as SheetInterface;
use Dcat\EasyExcel\Support\SheetCollection;

Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;each(function (SheetInterface $sheet) {

    // 每100行数据为一批数据进行读取
    $chunkSize = 100;

    $sheet-&gt;chunk($chunkSize, function (SheetCollection $collection) {
        // 此处的数组下标依然是excel表中数据行的行号
        $rows = $collection-&gt;toArray();

        ...
    });
})</code></pre>
<p>操作单表格</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use Dcat\EasyExcel\Contracts\Sheet as SheetInterface;
use Dcat\EasyExcel\Support\SheetCollection;

// 每100行数据为一批数据进行读取
$chunkSize = 100;

Excel::import(&#039;/tmp/users.xlsx&#039;)
    -&gt;first()
    -&gt;chunk($chunkSize, function (SheetCollection $collection) {
         // 此处的数组下标依然是excel表中数据行的行号
         $rows = $collection-&gt;toArray();

         ...
     });</code></pre>
<h3>过滤数据行</h3>
<p>可以通过 <code  >Sheet::filter</code> 方法过滤掉读取到的数据行</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use Dcat\EasyExcel\Contracts\Sheet as SheetInterface;
use Dcat\EasyExcel\Support\SheetCollection;

// 每100行数据为一批数据进行读取
$chunkSize = 100;

$headings = [&#039;id&#039;, &#039;email&#039;, &#039;name&#039;];

Excel::import(&#039;/tmp/users.xlsx&#039;)
    -&gt;headings($headings)
    -&gt;first()
    -&gt;filter(function (array $row, int $line) {
        // 过滤掉id小于10或者行号小于5的数据行
        return $row[&#039;id&#039;] &gt; 10 &amp;&amp; $line &gt; 5;
    })
    -&gt;chunk($chunkSize, function (SheetCollection $collection) {
         ...
     });</code></pre>
<h3>each</h3>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use Dcat\EasyExcel\Contracts\Sheet as SheetInterface;
use Dcat\EasyExcel\Support\SheetCollection;

// 每100行数据为一批数据进行读取
$chunkSize = 100;

$headings = [&#039;id&#039;, &#039;email&#039;, &#039;name&#039;];

Excel::import(&#039;/tmp/users.xlsx&#039;)
    -&gt;headings($headings)
    -&gt;first()
    -&gt;each(function (array $row, int $line, array $originalHeadings) {
         $id    = $row[&#039;id&#039;];
         $email = $row[&#039;email&#039;];
     });</code></pre>
<h3>toArray</h3>
<p>读取表格内容并转化为数组</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use Dcat\EasyExcel\Contracts\Sheet as SheetInterface;

$activeSheetArray = Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;first()-&gt;toArray();

var_dump($activeSheetArray);

// 多表格
Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;each(function (SheetInterface as $sheet) {
    $sheetArray = $sheet-&gt;toArray();
});</code></pre>
<h3>collect</h3>
<p>读取表格内容并转化为<code  >SheetCollection</code>对象</p>
<pre><code   class="language-php">use Dcat\EasyExcel\Excel;
use Dcat\EasyExcel\Contracts\Sheet as SheetInterface;

$collection = Excel::import(&#039;/tmp/users.xlsx&#039;)
    -&gt;first()
    -&gt;collect()
    -&gt;groupBy(&#039;name&#039;);

var_dump($collection-&gt;toArray());

// 多表格
Excel::import(&#039;/tmp/users.xlsx&#039;)-&gt;each(function (SheetInterface as $sheet) {
    $sheetCollection = $sheet-&gt;collect();
});</code></pre>

		<div id="comment-container" style="margin-top: 90px"></div>
	</article>

</div>

    <footer class="main">
        <ul>
            <li class=""><a href="../../docs.html">

        文档</a></li>
<li class=""><a href="https://github.com/jqhph/easy-excel" target="_blank">

        Github</a></li>
<li class=""><a href="../../docs.html">
        打赏</a></li>



    
    

        
        

        

        
        
        
        
        
        

    

        </ul>
        <p>Built by <b>jqh</b>. Copyright &copy; 2019</p>
        <p class="less-significant">
            <a href="http://jackmcdade.com">
                Designed by<br>
                assets/svg/jack-mcdade.svg
            </a>
        </p>
    </footer>

    <div class="fixed-bottom-btn"><a class="waves-effect waves-light" id="go-top"><i class="fa fa-chevron-up"></i></a></div>

    <script>
    var DcatPage = {
        version: 'master',

        getDocUrl: function (doc) {
            var temp = 'docs/master/{doc}.html';

            if (location.pathname.indexOf(temp.replace('{doc}.html', '')) !== -1) {
                return doc+'.html';
            }

            return temp.replace('{doc}', doc);
        },

        config: {"authors":[{"name":"jqh","email":"841324345@qq.com"}],"homepage":"https:\/\/github.com\/jqhph\/easy-excel","description":"\u4f7f\u7528\u7b80\u5355\u6613\u7528\u7684\u8bed\u4e49\u5316\u63a5\u53e3\u5feb\u901f\u8bfb\u5199Excel\u6587\u4ef6","website":{"title":"Easy Excel","keywords":"Easy Excel, xlsx, csv, ods, box spout","description":"\u4f7f\u7528\u7b80\u5355\u6613\u7528\u7684\u8bed\u4e49\u5316\u63a5\u53e3\u5feb\u901f\u8bfb\u5199Excel\u6587\u4ef6"},"doc":{"default":"installation","index":"documentation","version":"master","ignore":[]},"comment":{"enable":true,"clientID":"19ce86605d804660b3b6","clientSecret":"e64e4208f513c396f948699cfddc461d2f6e4b27","repo":"easy-excel-comments","owner":"jqhwx","admin":["jqhwx"],"language":"zh-CN","perPage":15,"pagerDirection":"first"}},
    };

    DcatPage.config.comment.id = 'master/import';

    (function () {
        function indices() {
            var s = document.createElement('script');
            s.type = 'text/javascript';
            s.async = true;
            s.src="../../assets/indices/master.js";
            var x = document.getElementsByTagName('script')[0];
            x.parentNode.insertBefore(s, x);
        }

        setTimeout(indices, 1);
    })();

</script>

             <script src="../../assets/gitalk/gitalk.min.js"></script>
         <script src="../../assets/js/laravel.js"></script>
     <script src="../../assets/js/viewport-units-buggyfill.js"></script>
    <script>window.viewportUnitsBuggyfill.init();</script>

</body>
</html>
